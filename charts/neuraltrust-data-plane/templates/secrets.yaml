{{- $secretName := "data-plane-jwt-secret" }}
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.dataPlaneJWTSecretName }}
{{- $secretName = .Values.dataPlane.secrets.dataPlaneJWTSecretName }}
{{- end }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $secretName) }}
{{- /* Check if secret already exists - if so, skip creation to allow pre-created secrets */}}
{{- $jwtSecretValue := "" }}
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.dataPlaneJWTSecret }}
  {{- $jwtSecretValue = .Values.dataPlane.secrets.dataPlaneJWTSecret }}
{{- end }}
{{- /* Create secret if it doesn't exist AND values are provided (skip if secret already exists to allow pre-created secrets) */}}
{{- if and (not $existingSecret) $jwtSecretValue }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neuraltrust-data-plane.labels" . | nindent 4 }}
type: Opaque
data:
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "DATA_PLANE_JWT_SECRET"}
  DATA_PLANE_JWT_SECRET: {{ include "data-plane.getSecretValue" (dict "value" $jwtSecretValue "secretName" $secretName "secretKey" "DATA_PLANE_JWT_SECRET" "context" $) }}
{{- end }}
---
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.openaiApiKey }}
{{- $secretName := "openai-secrets" }}
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.openaiApiKeySecretName }}
{{- $secretName = .Values.dataPlane.secrets.openaiApiKeySecretName }}
{{- end }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $secretName) }}
{{- if not $existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neuraltrust-data-plane.labels" . | nindent 4 }}
type: Opaque
data:
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "OPENAI_API_KEY"}
  OPENAI_API_KEY: {{ include "data-plane.getSecretValue" (dict "value" .Values.dataPlane.secrets.openaiApiKey "secretName" $secretName "secretKey" "OPENAI_API_KEY" "context" $) }}
{{- end }}
{{- end }}
---
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.googleApiKey }}
{{- $secretName := "google-secrets" }}
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.googleApiKeySecretName }}
{{- $secretName = .Values.dataPlane.secrets.googleApiKeySecretName }}
{{- end }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $secretName) }}
{{- if not $existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neuraltrust-data-plane.labels" . | nindent 4 }}
type: Opaque
data:
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "GOOGLE_API_KEY"}
  GOOGLE_API_KEY: {{ include "data-plane.getSecretValue" (dict "value" .Values.dataPlane.secrets.googleApiKey "secretName" $secretName "secretKey" "GOOGLE_API_KEY" "context" $) }}
{{- end }}
{{- end }}
---
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.resendApiKey }}
{{- $secretName := "resend-secrets" }}
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.resendApiKeySecretName }}
{{- $secretName = .Values.dataPlane.secrets.resendApiKeySecretName }}
{{- end }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $secretName) }}
{{- if not $existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neuraltrust-data-plane.labels" . | nindent 4 }}
type: Opaque
data:
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "RESEND_API_KEY"}
  RESEND_API_KEY: {{ include "data-plane.getSecretValue" (dict "value" .Values.dataPlane.secrets.resendApiKey "secretName" $secretName "secretKey" "RESEND_API_KEY" "context" $) }}
{{- end }}
{{- end }} 
---
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.huggingFaceToken }}
{{- $secretName := "huggingface-secrets" }}
{{- if and .Values.dataPlane .Values.dataPlane.secrets .Values.dataPlane.secrets.huggingFaceTokenSecretName }}
{{- $secretName = .Values.dataPlane.secrets.huggingFaceTokenSecretName }}
{{- end }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $secretName) }}
{{- if not $existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "neuraltrust-data-plane.labels" . | nindent 4 }}
type: Opaque
data:
  # Supports both direct value or secret reference: {secretName: "my-secret", secretKey: "HUGGINGFACE_TOKEN"}
  HUGGINGFACE_TOKEN: {{ include "data-plane.getSecretValue" (dict "value" .Values.dataPlane.secrets.huggingFaceToken "secretName" $secretName "secretKey" "HUGGINGFACE_TOKEN" "context" $) }}
{{- end }}
{{- end }} 