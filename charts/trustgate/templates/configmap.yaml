apiVersion: v1
kind: ConfigMap
metadata:
  name: trustgate-config
  labels:
    {{- include "trustgate.labels" . | nindent 4 }}
data:
  config.yaml: |
    server:
      admin_port: 8080
      proxy_port: 8081
      actions_port: 8084
      metrics_port: 9090
      {{- /* Use the same logic as env-configmap for consistency */}}
      {{- $baseDomain := "" }}
      {{- $openshiftDomain := .Values.global.openshiftDomain | default $.Values.global.openshiftDomain }}
      {{- if .Values.global.env.SERVER_BASE_DOMAIN }}
        {{- $baseDomain = .Values.global.env.SERVER_BASE_DOMAIN }}
      {{- else if .Values.config.baseDomain }}
        {{- $baseDomain = .Values.config.baseDomain }}
      {{- else if and (or .Values.global.openshift $.Values.global.openshift) $openshiftDomain }}
        {{- $baseDomain = $openshiftDomain }}
      {{- else }}
        {{- $baseDomain = "neuraltrust.ai" }}
      {{- end }}
      base_domain: {{ $baseDomain | quote }}

    metrics:
      enabled: true
      enable_latency: true
      enable_upstream: true
      enable_connections: true
      enable_per_route: true

    database:
      host: {{ .Values.global.env.DATABASE_HOST }}
      port: {{ .Values.global.env.DATABASE_PORT }}
      user: {{ .Values.global.env.DATABASE_USER }}
      password: {{ .Values.global.env.DATABASE_PASSWORD }}
      dbname: {{ .Values.global.env.DATABASE_NAME }}
      ssl_mode: {{ .Values.global.env.DATABASE_SSL_MODE }}

    redis:
      host: {{ .Values.global.env.REDIS_HOST }}
      port: {{ .Values.global.env.REDIS_PORT }}
      db: {{ .Values.global.env.REDIS_DB }}