# NeuralTrust Platform Values (example)
# Copy this file to my-values.yaml, fill every value marked # Required, then:
#   helm upgrade --install neuraltrust-platform <chart> -f my-values.yaml
# Only mandatory/required configuration - all other values use chart defaults
#
# Secret Auto-Generation:
#   When global.autoGenerateSecrets: true (default), all secrets marked
#   "Auto-generated if empty" are automatically generated during helm install/upgrade.
#   Existing secrets in the cluster are preserved on upgrades (never overwritten).
#   SERVER_SECRET_KEY and trustgateJwtSecret are automatically synchronized.

global:
  openshift: false
  imageRegistry: ""
  autoGenerateSecrets: true  # Auto-generate required secrets if not explicitly provided. Preserves existing values on upgrades.
  preserveExistingSecrets: false
  storageClass: ""

# Infrastructure Components
infrastructure:
  clickhouse:
    deploy: true

  kafka:
    deploy: true

  postgresql:
    # Note: PostgreSQL deployment is controlled by neuraltrust-control-plane.infrastructure.postgresql.deploy below
    # Set deploy: true/false in that section to enable/disable in-cluster PostgreSQL deployment

# ClickHouse subchart (only if infrastructure.clickhouse.deploy=true)
clickhouse:
  auth:
    username: "neuraltrust"
    # ClickHouse password - auto-generated if empty and autoGenerateSecrets: true
    # You can use openssl to generate a specific value: openssl rand -hex 32
    password: "" # Auto-generated if empty
  image:
    repository: "bitnamilegacy/clickhouse"
    tag: "25.3.2-debian-12-r3"
  global:
    imagePullSecrets: []

# Kafka subchart (only if infrastructure.kafka.deploy=true)
kafka:
  image:
    repository: "bitnamilegacy/kafka"
    tag: "3.9.0-debian-12-r1"
  global:
    imagePullSecrets: []

# TrustGate Configuration
trustgate:
  enabled: true
  global:
    version: "ee"
    imageRegistry: "europe-west1-docker.pkg.dev/neuraltrust-app-prod/nt-docker"
    image:
      imagePullSecrets: ["gcr-secret"]
    env:
      # TrustGate secret key - auto-generated if empty and autoGenerateSecrets: true
      # Shared with neuraltrust-control-plane.controlPlane.secrets.trustgateJwtSecret
      SERVER_SECRET_KEY: "" # Auto-generated if empty
      # Database host is the host of the PostgreSQL database
      DATABASE_HOST: "control-plane-postgresql" # Required
      # TrustGate database password - auto-generated if empty and autoGenerateSecrets: true
      DATABASE_PASSWORD: "" # Auto-generated if empty
  redis:
    enabled: true
    # Note: redis.auth.password is optional - only recommended when using external Redis (redis.enabled: false)

# NeuralTrust Control Plane
neuraltrust-control-plane:
  infrastructure:
    postgresql:
      deploy: true
  controlPlane:
    enabled: true
    imagePullSecrets: "gcr-secret"
    secrets:
      # ControlPlane JWT secret - auto-generated if empty and autoGenerateSecrets: true
      controlPlaneJWTSecret: "" # Auto-generated if empty
      # TrustGate JWT secret - auto-generated if empty and autoGenerateSecrets: true
      # Automatically synchronized with trustgate.global.env.SERVER_SECRET_KEY
      trustgateJwtSecret: "" # Auto-generated if empty (= SERVER_SECRET_KEY)
    components:
      scheduler:
        enabled: true
      api:
        enabled: true
      app:
        enabled: true
      postgresql:
        secrets:
          # PostgreSQL password - auto-generated if empty and autoGenerateSecrets: true
          password: "" # Auto-generated if empty
        image:
          repository: "postgres"
          tag: "17.2-alpine"

# NeuralTrust Data Plane
neuraltrust-data-plane:
  dataPlane:
    enabled: true
    imagePullSecrets: "gcr-secret"
    secrets:
      # DataPlane JWT secret - auto-generated if empty and autoGenerateSecrets: true
      dataPlaneJWTSecret: "" # Auto-generated if empty
    components:
      api:
        enabled: true
      worker:
        enabled: true
      kafka:
        connect: {}
